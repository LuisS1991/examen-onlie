"""git config --global user.email "nantesluis72@gmail.com"
git config --global user.name "LuisS1991"
#genera base datgos
reflex db init
#construye archivos de tablas
reflex db makemigrations --message "create tables"
#ejecuta migracion
reflex db migrate
#generar seed para insertar datos
alembic revision -m "seed usuario default"

"""

"""seed usuario default

Revision ID: cd6ae3f37ab6
Revises: 378e41f45408
Create Date: 2025-12-30 23:00:08.281619

"""

from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from passlib.hash import bcrypt

# revision identifiers, used by Alembic.
revision: str = "cd6ae3f37ab6"
down_revision: Union[str, Sequence[str], None] = "378e41f45408"
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    conn = op.get_bind()

    # verifica si el admin ya existe
    exists = conn.execute(
        sa.text("SELECT 1 FROM usuario WHERE email = :email"),
        {"email": "nantesluis72@gmail.com"},
    ).fetchone()

    if not exists:
        # crear hash de la contraseña
        hashed_pw = bcrypt.hash("1234")  # cambiar por tu contraseña inicial segura

        conn.execute(
            sa.text(
                "INSERT INTO usuario (nombre, email, password, rol) "
                "VALUES (:nombre, :email, :password, :rol)"
            ),
            {
                "nombre": "Luis Nantes",
                "email": "nantesluis72@gmail.com",
                "password": hashed_pw,
                "rol": "admin",
            },
        )


def downgrade() -> None:
    """Downgrade schema."""
    conn = op.get_bind()
    conn.execute(sa.text("DELETE FROM usuario WHERE email = 'admin@example.com'"))
